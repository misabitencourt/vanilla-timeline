"use strict";!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=9)}([function(module,exports,__webpack_require__){function removeSelection(table){for(var oldSelection=table.querySelectorAll(".timeline-drag-selection"),i=0;i<oldSelection.length;i++){oldSelection[i].classList.remove("timeline-drag-selection")}}function createResizeEls(td,params,booking){var leftEl=document.createElement("div"),centerEl=document.createElement("div"),titleSpan=document.createElement("span"),subtitleSpan=document.createElement("span"),rightEl=document.createElement("div"),parent=td.parentElement.parentElement,currentCellWidth=cellWidth*(td.colSpan||1),resizeElWidth=cellWidth/4;titleSpan.classList.add("title"),subtitleSpan.classList.add("subtitle"),td.innerHTML="",td.appendChild(leftEl),td.appendChild(centerEl),td.appendChild(rightEl),booking.customClass&&td.classList.add(booking.customClass),titleSpan.textContent=td.dataset.content,subtitleSpan.textContent=booking.subtitle||"",centerEl.appendChild(titleSpan),titleSpan.style.float="left",subtitleSpan.style.float="right",centerEl.appendChild(subtitleSpan),centerEl.style.marginTop=cellHeight/4+"px",centerEl.style.height=.6*cellHeight+"px",centerEl.style.width=currentCellWidth-2*resizeElWidth+"px",centerEl.style.float=leftEl.style.float="left",rightEl.style.float="right",leftEl.style.height=rightEl.style.height=cellHeight+"px",leftEl.style.width=rightEl.style.width=resizeElWidth+"px",leftEl.style.cursor=rightEl.style.cursor="ew-resize",centerEl.style.overflow="hidden",rightEl.classList.add("resizable"),leftEl.classList.add("resizable"),centerEl.classList.add("draggable");var isResizing=null,clickTime=null,clickedRow=0,clickedPos=0,draggedPos=0,mousedown=function(e,direction){if(e.target.classList.contains("draggable")){var refElement=document.createElement("div");return refElement.style.position="fixed",refElement.style.left=e.clientX+"px",refElement.style.top=e.clientY+"px",refElement.style.width="auto",refElement.textContent=centerEl.textContent,refElement.classList.add("draggable-ref"),document.body.appendChild(refElement),void(window.mouseDragging={params:params,booking:booking,td:td})}clickTime=(new Date).getTime(),isResizing=direction,clickedPos={x:e.x,y:e.y},clickedRow=td.dataset.row},mouseup=function(e){var now=(new Date).getTime(),diff=now-(clickTime||1e7);if(disableCreateRange)return clickedPos=clickTime=null,removeSelection(parent),setTimeout(function(){return disableCreateRange=!1},300);if(diff<1e3&&params.onBookingClick)params.onBookingClick(booking);else if(params.onCreateRage){console.log("Criando Range");var target=e.target,selection=void 0;target.dataset.dateItem||(target=target.parentElement),selection=Array.from(target.parentElement.querySelectorAll(".timeline-drag-selection"));var elStart=selection.slice().shift(),elEnd=selection.slice().pop();if(elStart&&elEnd){var start=new Date,end=new Date;start.setTime(elStart.dataset.dateItem),end.setTime(elEnd.dataset.dateItem),params.onCreateRage(start,end,elStart.dataset.subjectItem)}}clickedPos=clickTime=null,removeSelection(parent)},mousemove=function(e,direction){Array.from(document.querySelectorAll(".draggable-ref")).forEach(function(dragEl){dragEl.style.left=e.clientX+"px",dragEl.style.top=e.clientY+"px"}),clickedPos&&clickedRow&&(draggedPos={x:e.x-clickedPos.x,y:e.y-clickedPos.y},"l"===direction&&(draggedPos.x=-1*draggedPos.x),draggedPos.x>cellWidth/4&&(window.mouseMoveTimeout&&window.clearTimeout(window.mouseMoveTimeout),window.mouseMoveTimeout=setTimeout(function(){removeSelection(parent),"l"===direction&&(draggedPos.x=-1*draggedPos.x);for(var itemsRange=1,pxRange=draggedPos.x-cellWidth/4;pxRange>cellWidth;)pxRange-=cellWidth,itemsRange++;for(var i=0;i<itemsRange;i++){var nextColNum=1*td.dataset.column;"r"===direction?(nextColNum+=1*(td.colSpan||1),nextColNum+=i):nextColNum-=i+1;var nextCol=parent.querySelector('td[data-row="'+clickedRow+'"][data-column="'+nextColNum+'"]');if(!nextCol)return;if(nextCol.colSpan&&1!=nextCol.colSpan)return;nextCol.classList.add("timeline-drag-selection")}params.onResizeBooking&&(disableCreateRange=!0,params.onResizeBooking(booking,"r"===direction?itemsRange:-1*itemsRange))},10)))};centerEl.addEventListener("mousedown",function(e){return mousedown(e)}),leftEl.addEventListener("mousedown",function(e){return mousedown(e,"l")}),rightEl.addEventListener("mousedown",function(e){return mousedown(e,"r")}),parent.addEventListener("mousemove",function(e){return mousemove(e,"l")}),parent.addEventListener("mousemove",function(e){return mousemove(e,"r")}),centerEl.addEventListener("mouseup",function(e){return mouseup(e)}),parent.addEventListener("mouseup",function(e){return mouseup(e)}),parent.addEventListener("mouseup",function(e){return mouseup(e)})}var cellWidth=63,cellHeight=60,disableCreateRange=!1;exports.a=function(params){function killEl(el){el.parentElement&&el.parentElement.removeChild(el)}if(console.log(params.data.booking.length),0==params.data.booking.length){var parentMouseUP=function(e){if(params.onCreateRage){console.log("Criando Range");var target=e.target,selection=void 0;target.dataset.dateItem||(target=target.parentElement),selection=Array.from(target.parentElement.querySelectorAll(".timeline-drag-selection"));var elStart=selection.slice().shift(),elEnd=selection.slice().pop();if(elStart&&elEnd){var start=new Date,end=new Date;start.setTime(elStart.dataset.dateItem),end.setTime(elEnd.dataset.dateItem),params.onCreateRage(start,end,elStart.dataset.subjectItem)}}},parent=document.querySelector("td").parentElement.parentElement;parent.addEventListener("mouseup",function(e){return parentMouseUP(e)}),console.log(parent)}params.data.booking.forEach(function(booking){var date=new Date(booking.start),outDate=new Date(booking.end),timeDiff=outDate.getTime()-date.getTime(),dayDiff=parseInt(timeDiff/864e5),startSelector='[data-subject-item="'+booking.subject+'"][data-date-item="'+date.getTime()+'"]',endSelector='[data-subject-item="'+booking.subject+'"][data-date-item="'+outDate.getTime()+'"]',tdStart=document.querySelector(startSelector);document.querySelector(endSelector);for(booking.daysDiff=dayDiff,tdStart.colSpan=dayDiff+1,tdStart.style.backgroundColor="#DDD",tdStart.dataset.content=booking.name,createResizeEls(tdStart,params,booking);date.getTime()<outDate.getTime();){date.setTime(date.getTime()+864e5);var selector='[data-subject-item="'+booking.subject+'"][data-date-item="'+date.getTime()+'"]',td=params.bookingDiv.querySelector(selector);td&&killEl(td)}}),document.addEventListener("mouseup",function(e){Array.from(document.querySelectorAll(".draggable-ref")).forEach(function(e){return e.parentElement.removeChild(e)});var selection=Array.from(document.querySelectorAll(".timeline-drag-selection"));if(selection.forEach(function(e){return e.classList.remove("timeline-drag-selection")}),window.mouseDragging){var booking=(window.mouseDragging.td,mouseDragging.booking),date=new Date;date.setTime(selection.slice().shift().dataset.dateItem);var subject=selection.slice().pop().dataset.subjectItem;params.onBookingMove&&params.onBookingMove(booking,date,subject),delete window.mouseDragging}})}},function(module,exports,__webpack_require__){exports.a={monthNames:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]}},function(module,exports,__webpack_require__){function getDefaultDateInterval(){var start=new Date;start.setUTCHours(0,0,0,0);var end=new Date;return end.setUTCHours(0,0,0,0),end.setTime(end.getTime()+10368e5),start.setTime(start.getTime()),{start:start,end:end}}function getThDateInterval(interval){return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__arr_date_interval__.a)(interval).map(__WEBPACK_IMPORTED_MODULE_0__th_date_interval_template__.a).join("")}function createMonthsTable(params){var dateInterval=params.data.booking.length?__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__filters__.a)(params.data):getDefaultDateInterval(),tbl=document.createElement("table");tbl.border=0,tbl.className=params.tableClass||"timeline-table-header",tbl.innerHTML="<thead></thead>",tbl.getElementsByTagName("thead")[0].innerHTML="\n        <tr>\n            "+getThDateInterval(dateInterval)+"\n        </tr>\n    ";var tbl2=document.createElement("table");tbl2.className=params.tableClass||"timeline-table",tbl2.innerHTML="<tbody></tbody>",params.contentTable=tbl2;var tbody=tbl2.getElementsByTagName("tbody")[0],interval=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__arr_date_interval__.a)(dateInterval);tbody.innerHTML=params.data.subjects.map(function(s,row){return'\n        <tr>\n            <td class="subject-category-'+s.category+'">\n                <div style="width: 63px; height: 18px"></div>\n            </td>\n            '+interval.map(function(d,column){return column+1==interval.length?"":'\n                    <td data-subject-item="'+s.id+'" \n                        data-date-item="'+d.getTime()+'"\n                        data-column="'+column+'"\n                        data-row="'+row+'"\n                        data-type="empty"\n                        class="subject-category-'+s.category+'">\n                        <div style="width: 63px; height: 18px"></div>\n                    </td>\n                '}).join("")+"\n        </tr>\n    "}).join(""),__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__empty_drag__.a)(Array.from(tbody.querySelectorAll('td[data-type="empty"]')));var div=document.createElement("div");div.style.width=window.innerWidth>800?"78%":"50%",div.style.overflow="hidden";var headerDiv=document.createElement("div");headerDiv.style.height="100%",headerDiv.style.width="100vw",headerDiv.style.overflow="hidden",headerDiv.style.marginBottom="3px",headerDiv.appendChild(tbl);var bookingDiv=document.createElement("div");return params.bookingDiv=bookingDiv,bookingDiv.style.height=params.sizes.divX-60+"px",bookingDiv.style.overflowX="auto",bookingDiv.appendChild(tbl2),bookingDiv.addEventListener("scroll",function(e){tbl.style.marginLeft="-"+e.target.scrollLeft+"px",params.el.querySelector("[data-subjects-table]").style.marginTop="-"+e.target.scrollTop+"px"}),div.appendChild(headerDiv),div.appendChild(bookingDiv),Array.from(tbody.querySelectorAll("td")).forEach(function(td){return td.addEventListener("mouseover",function(e){if(window.mouseDragging){Array.from(document.querySelectorAll(".timeline-drag-selection")).forEach(function(e){return e.classList.remove("timeline-drag-selection")});var tr=td.parentElement,days=window.mouseDragging.booking.daysDiff,currentCol=1*td.dataset.column||0;td.classList.add("timeline-drag-selection");for(var i=currentCol;i<currentCol+days+1;i++){var currentTd=tr.querySelector('[data-column="'+i+'"]');currentTd&&currentTd.classList.add("timeline-drag-selection")}}})}),div}function createTable(params){var generalMarginY=window.innerHeight>520?200:.13*window.innerHeight,divX=window.innerHeight-generalMarginY,wrp=params.el;wrp.style.width="100%",wrp.style.height=divX+"px",params.sizes={divX:divX};var subjectsTbl=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__create_subjects_table__.a)(params),monthsTbl=createMonthsTable(params);subjectsTbl.style.float=monthsTbl.style.float="left";var clearFix=document.createElement("br");clearFix.style.clear="both",wrp.style.overflowX="hidden",wrp.appendChild(subjectsTbl),wrp.appendChild(monthsTbl),wrp.appendChild(clearFix),subjectsTbl.style.marginTop="60px"}var __WEBPACK_IMPORTED_MODULE_0__th_date_interval_template__=__webpack_require__(8),__WEBPACK_IMPORTED_MODULE_1__create_subjects_table__=__webpack_require__(6),__WEBPACK_IMPORTED_MODULE_2__arr_date_interval__=__webpack_require__(5),__WEBPACK_IMPORTED_MODULE_3__filters__=__webpack_require__(4),__WEBPACK_IMPORTED_MODULE_4__empty_drag__=__webpack_require__(7);exports.a=createTable},function(module,exports,__webpack_require__){function findDuplicate(list,item){return!!list.find(function(i){return i!==item&&i.id===item.id})}function validateWithIdAndName(listName,list,errors){list&&list.length?list.forEach(function(categ){categ.id||errors.push(listName+" has item without id!!"),categ.name||errors.push(listName+" has item without name!!"),findDuplicate(list,categ)&&errors.push(listName+" has item with duplicate id")}):errors.push("No "+listName+" defined")}function isValidIsoDate(date){return!!date&&("string"==typeof date&&(3===date.split("-").length&&""+new Date(date)!="Invalid Date"))}exports.a=function(data){var errors=[];return validateWithIdAndName("categories",data.subjectCategs,errors),data.subjects&&data.subjects.length?data.subjects.forEach(function(sbj){sbj.id||errors.push("Subject without id!!"),sbj.name||errors.push("Subject without name!!"),sbj.category||errors.push("Subject without category!!"),findDuplicate(data.subjects,sbj)&&errors.push("subject with duplicate id")}):errors.push("No subjects defined"),validateWithIdAndName("statuses",data.statuses,errors),data.booking&&data.booking.length?data.booking.forEach(function(booking){if(booking.id||errors.push("Booking without id!!"),booking.name||errors.push("Booking without name!!"),booking.start||errors.push("Booking without start date!!"),booking.end||errors.push("Booking without end date!!"),isValidIsoDate(booking.start)||errors.push("Booking with invalid start date!!"),isValidIsoDate(booking.end)||errors.push("Booking with invalid end date!!"),booking.subject){(data.subjects||[]).find(function(s){return s.id===booking.subject})||errors.push("Booking subject "+booking.subject+" isnt exists!!")}else errors.push("Booking without subject!!")}):errors.push("No booking!!"),errors}},function(module,exports,__webpack_require__){function getEarlyDate(data){var selected=null;return data.booking.forEach(function(b){var date=new Date(b.start);date=new Date(date.getTime()),console.log(date),(!selected||date.getTime()<selected.getTime())&&(selected=date)}),selected.setTime(selected.getTime()-oneDay),selected}function getLatestDate(data){var selected=null;return data.booking.forEach(function(b){var date=new Date(b.end);(!selected||date.getTime()>selected.getTime())&&(selected=date)}),selected.setTime(selected.getTime()+2*oneDay),selected}function getDateInterval(data){return{start:getEarlyDate(data),end:getLatestDate(data)}}exports.a=getDateInterval;var oneDay=864e5},function(module,exports,__webpack_require__){function getArrDateInterval(interval){for(var intervalArr=[interval.start],cursor=new Date(interval.start+""),end=new Date(interval.end+"");cursor.getTime()<=end.getTime();)cursor.setTime(cursor.getTime()+oneDay),intervalArr.push(new Date(cursor+""));return intervalArr}exports.a=getArrDateInterval;var oneDay=864e5},function(module,exports,__webpack_require__){function createSubjectsTable(params){var div=document.createElement("div");div.style.width=window.innerWidth>800?"20%":"38%";var tbl=document.createElement("table");tbl.border=0,tbl.dataset.subjectsTable="1",tbl.className=params.tableClass||"timeline-table-subjects";var tbody=document.createElement("tbody");tbl.appendChild(tbody),tbody.innerHTML=params.data.subjects.map(function(s){return'\n        <tr>\n            <th data-subject="'+s.id+'" title="'+s.description+'"\n                class="subject-category-'+s.category+" "+(s.customClass||"")+'">\n                '+s.name+"\n            </th>\n        </tr>\n    "}).join("");var quartosHeader=document.createElement("div");return quartosHeader.id="quartosHeader",quartosHeader.innerText="Quartos",div.style.height=params.sizes.divX-60+"px",div.style.overflowY="hidden",div.appendChild(quartosHeader),div.appendChild(tbl),div}exports.a=createSubjectsTable},function(module,exports,__webpack_require__){exports.a=function(tds){tds.forEach(function(td){td.addEventListener("mousedown",function(){window.timelineEmptyDragging=td,td.classList.add("timeline-drag-selection")}),td.addEventListener("mouseover",function(){var startPoint=window.timelineEmptyDragging;if(startPoint&&startPoint.dataset.subjectItem===td.dataset.subjectItem){td.classList.add("timeline-drag-selection");var isForward=1*startPoint.dataset.dateItem<1*td.dataset.dateItem,allSelected=Array.from(td.parentElement.querySelectorAll('.timeline-drag-selection[data-type="empty"]'));if(isForward){allSelected.filter(function(selectedTd){return 1*selectedTd.dataset.dateItem<1*startPoint.dataset.dateItem}).forEach(function(oldTd){return oldTd.classList.remove("timeline-drag-selection")});allSelected.filter(function(selectedTd){return 1*selectedTd.dataset.dateItem>1*td.dataset.dateItem}).forEach(function(oldTd){return oldTd.classList.remove("timeline-drag-selection")})}else{allSelected.filter(function(selectedTd){return 1*selectedTd.dataset.dateItem>1*startPoint.dataset.dateItem}).forEach(function(newestTd){return newestTd.classList.remove("timeline-drag-selection")});allSelected.filter(function(selectedTd){return 1*selectedTd.dataset.dateItem<1*td.dataset.dateItem}).forEach(function(oldTd){return oldTd.classList.remove("timeline-drag-selection")})}}})}),document.addEventListener("mouseup",function(){delete window.timelineEmptyDragging})}},function(module,exports,__webpack_require__){function getMonthName(nr){return window.$timelineTableConfig.monthNames[1*nr]}exports.a=function(date){var year=(date.getFullYear()+"").substr(2,4),month=getMonthName(date.getMonth());return'\n        <th>\n            <small class="timeline-table-date-year">\n                '+year+'\n            </small>\n            <span class="timeline-table-date-day">\n                '+date.getDate()+'\n            </span>\n            <span class="timeline-table-date-month">\n                '+month+"\n            </span>\n        </th>\n    "}},function(module,exports,__webpack_require__){var __WEBPACK_IMPORTED_MODULE_0__validation__=__webpack_require__(3),__WEBPACK_IMPORTED_MODULE_1__layout__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_2__defaults__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_3__booking__=__webpack_require__(0);window.$timelineTableConfig=window.$timelineTableConfig||__WEBPACK_IMPORTED_MODULE_2__defaults__.a,window.createBookingMap=function(params){function refresh(){params.el.innerHTML="",createBookingMap(params)}var errors=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__validation__.a)(params.data);errors.length&&errors.forEach(function(e){return console.error(e)}),__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1__layout__.a)(params),__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3__booking__.a)(params),window.addEventListener("resize",function(){window.resizeTimeout&&window.clearTimeout(window.resizeTimeout),window.resizeTimeout=window.setTimeout(refresh,500)})},exports.default=window.createBookingMap}]);